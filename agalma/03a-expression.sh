#!/bin/bash
#SBATCH -t 24:00:00
#SBATCH -c 8
#SBATCH --mem=20G
#SBATCH -C intel
#SBATCH --array=1-27

set -e

export AGALMA_DB="/gpfs/data/cdunn/analyses/agalma-siphonophora-20170209.sqlite"
export BIOLITE_RESOURCES="threads=${SLURM_CPUS_ON_NODE},memory=${SLURM_MEM_PER_NODE}M"

REFS=(
	HWI-ST625-73-C0JUVACXX-7-AGALMA2
	HWI-ST625-73-C0JUVACXX-7-AGALMA2
	HWI-ST625-73-C0JUVACXX-7-AGALMA2
	HWI-ST625-73-C0JUVACXX-7-AGALMA2
	HWI-ST625-73-C0JUVACXX-7-AGALMA2
	HWI-ST625-73-C0JUVACXX-7-AGALMA2
	HWI-ST625-51-C02UNACXX-8-BARGMANNIA
	HWI-ST625-51-C02UNACXX-8-BARGMANNIA
	HWI-ST625-51-C02UNACXX-8-BARGMANNIA
	HWI-ST625-51-C02UNACXX-8-BARGMANNIA
	HWI-ST625-51-C02UNACXX-8-BARGMANNIA
	HWI-ST625-51-C02UNACXX-8-BARGMANNIA
	HWI-ST625-51-C02UNACXX-6-FRILLAGALMA
	HWI-ST625-51-C02UNACXX-6-FRILLAGALMA
	HWI-ST625-51-C02UNACXX-6-FRILLAGALMA
	HWI-ST625-51-C02UNACXX-6-FRILLAGALMA
	HWI-ST625-51-C02UNACXX-6-FRILLAGALMA
	HWI-ST625-51-C02UNACXX-6-FRILLAGALMA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
	HWI-ST625-51-C02UNACXX-7-NANOMIA
)

IDS=(
	HWI-ST625-75-D0PBDACXX-6-CGATGT
	HWI-ST625-75-D0PBDACXX-6-TTAGGC
	HWI-ST625-75-D0PBDACXX-6-GCCAAT
	HWI-ST625-75-D0PBDACXX-6-CAGATC
	HWI-ST625-75-D0PBDACXX-6-ACTTGA
	HWI-ST625-75-D0PBDACXX-6-GATCAG
	HWI-ST625-49-A81MCVABXX-6-CGATGT
	HWI-ST625-49-A81MCVABXX-6-TGACCA
	HWI-ST625-49-A81MCVABXX-6-ACAGTG
	HWI-ST625-49-A81MCVABXX-7-CTTGTA
	HWI-ST625-49-A81MCVABXX-7-GCCAAT
	HWI-ST625-49-A81MCVABXX-7-CAGATC
	EAS1745-19-unknown-1-0
	EAS1745-19-unknown-2-0
	EAS1745-19-unknown-5-0
	EAS1745-19-unknown-6-0
	EAS1745-19-unknown-7-0
	EAS1745-19-unknown-8-0
	HWI-ST625-75-D0PBDACXX-6-ATCACG
	HWI-ST625-75-D0PBDACXX-6-TGACCA
	HWI-ST625-75-D0PBDACXX-6-ACAGTG
	EAS1745-0004-unknown-1-0
	EAS1745-0004-unknown-2-0
	EAS1745-0004-unknown-3-0
	EAS1745-0004-unknown-6-0
	EAS1745-0004-unknown-7-0
	EAS1745-0004-unknown-8-0
)

ID=${IDS[$SLURM_ARRAY_TASK_ID-1]}
REF=${REFS[$SLURM_ARRAY_TASK_ID-1]}
echo $ID
echo $REF

mkdir -p $ID
cd $ID

agalma expression --id $ID $REF
